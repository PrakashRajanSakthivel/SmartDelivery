# Build stage
FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /source

# Copy solution and restore as distinct layers
COPY SmartDeliveryApp.sln ./
COPY src/RestaurantService.API/ ./src/RestaurantService.API/
COPY src/RestaurantService.Core/ ./src/RestaurantService.Core/
COPY src/RestaurantService.Infra/ ./src/RestaurantService.Infra/

# Restore dependencies
RUN dotnet restore ./src/RestaurantService.API/RestaurantService.API.csproj

# Build and publish
RUN dotnet publish ./src/RestaurantService.API/RestaurantService.API.csproj -c Release -o /app/publish

# Runtime stage
FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS runtime
WORKDIR /app
COPY --from=build /app/publish .
ENTRYPOINT ["dotnet", "RestaurantService.API.dll"]
